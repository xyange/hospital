<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wyzy.hospital.cyclopedia.mapper.DrugLevelMapper">

  <resultMap id="drugLevelMap" type="com.wyzy.hospital.cyclopedia.entity.DrugLevel">
                  <id property="id" column="id"/>
                        <result property="drugLevelName" column="drug_level_name"/>
                        <result property="parentId" column="parent_id"/>
                        <result property="levels" column="levels"/>
            </resultMap>

	<resultMap id="myDrugLevelMap" type="com.wyzy.hospital.cyclopedia.dto.DrugLevelDTO">
		<id property="id" column="id"/>
		<result property="drugLevelName" column="drug_level_name"/>
		<result property="levelDrugNumber" column="LevelDrugNumber"/>
		<collection property="drugDetailsDTOList" resultMap="myDrugDetails"/>
	</resultMap>
	<resultMap id="myDrugDetails" type="com.wyzy.hospital.cyclopedia.dto.DrugDetailsDTO">
		<id property="drugId" column="drug_id"/>
		<result property="drugName" column="drug_name"/>
		<result property="delectStatus" column="delect_status"/>
	</resultMap>



	<!-- 后台药品百科 -->
	<resultMap id="myDrugbackstage" type="com.wyzy.hospital.cyclopedia.dto.DrugLevelDTO">
		<id property="id" column="id"/>
		<result property="drugLevelName" column="drug_level_name"/>
		<collection property="drugDetailsDTOList" resultMap="myDrugDetailsbackstage"/>
	</resultMap>
	<resultMap id="myDrugDetailsbackstage" type="com.wyzy.hospital.cyclopedia.dto.DrugDetailsDTO">
		<id property="drugId" column="drug_id"/>
		<result property="drugName" column="drug_name"/>
		<collection property="drugTypeDTOList" resultMap="myDrugTypebackstage"></collection>
	</resultMap>
	<resultMap id="myDrugTypebackstage" type="com.wyzy.hospital.cyclopedia.dto.DrugTypeDTO">
		<id property="id" column="id"/>
		<result property="drugTypeName" column="drug_type_name"/>
		<collection property="cyReagentDTOList" resultMap="myCyReagentbackstage"></collection>
	</resultMap>
	<resultMap id="myCyReagentbackstage" type="com.wyzy.hospital.cyclopedia.dto.CyReagentDTO">
		<id property="cyReagentId" column="cy_reagent_id"/>
		<result property="cyReagentName" column="cy_reagent_name"/>
		<result property="uploadAdmin" column="upload_admin"/>
		<result property="auditStruts" column="audit_struts"/>
		<result property="auditAdmin" column="audit_admin"/>
		<result property="delStruts" column="del_struts"/>
		<result property="existStruts" column="exist_struts"/>
		<result property="reUploadTime" column="re_upload_time"/>
		<result property="reAuditTime" column="re_audit_time"/>
		<result property="reCheckPassTime" column="re_check_pass_time"/>
		<result property="createTime" column="create_time"/>
		<result property="updateTime" column="update_time"/>
		<collection property="cyCompanyDTOList" resultMap="myCyCompanybackstage"/>
		<collection property="cyReagenDetailsDTOList" resultMap="myCyReagenDetailsbackstage"></collection>
	</resultMap>
	<resultMap id="myCyCompanybackstage" type="com.wyzy.hospital.cyclopedia.dto.CyCompanyDTO">
		<id property="compayId" column="compay_id"/>
		<result property="compayName" column="compay_name"/>
	</resultMap>
	<resultMap id="myCyReagenDetailsbackstage" type="com.wyzy.hospital.cyclopedia.dto.CyReagenDetailsDTO">
		<id property="cyReagentDetailsId" column="cy_reagent_details_id"/>
		<result property="drugAlias" column="drug_alias"/>
		<result property="crowdMedication" column="crowd_medication"/>
		<result property="drugOther" column="drug_other"/>
		<result property="indications" column="Indications"/>
		<result property="takeMethod" column="take_method"/>
		<result property="medicineHint" column="medicine_hint"/>
		<result property="contraindication" column="contraindication"/>
		<result property="drugUnit" column="drug_unit"/>
		<result property="adverseReactions" column="adverse_reactions"/>
		<result property="drugDose" column="drug_dose"/>
		<result property="drugInteractions" column="drug_interactions"/>
	</resultMap>



<select id="selectOneTheDrugNumber" resultMap="myDrugLevelMap">
    SELECT l.id,l.drug_level_name,count(*)  LevelDrugNumber FROM drug_level l LEFT JOIN drug_details d ON l.id=d.drug_level_id
     WHERE levels=2 and d.delect_status=0
</select>

	<select id="selectTwoDrug" resultMap="myDrugLevelMap">
		SELECT l.id,l.drug_level_name , d.drug_id ,d.drug_name FROM drug_level l LEFT JOIN drug_details d ON l.id=d.drug_level_id
 where l.levels=2 and d.delect_status=0
	</select>



<select id="selectDrugNumber" resultType="int">
		SELECT count(d.drug_level_id)from drug_level a LEFT JOIN drug_level b ON a.parent_id=b.id LEFT JOIN drug_details d ON a.id=d.drug_level_id
	where a.id=#{id}
</select>

<select id="selectOneTheDrugTwoNum" resultType="int">
	select count(b.id) number from drug_level a LEFT JOIN drug_level b ON a.id=b.parent_id WHERE a.id=#{aid}
</select>



<!-- 后台百科审核 -->
<select id="selectDrugBackTable" resultMap="myDrugbackstage">
	   SELECT a.id,a.drug_level_name,d.drug_id,d.drug_name,r.cy_reagent_id,r.cy_reagent_name,c.compay_id,c.compay_name,r.upload_admin,r.create_time,r.audit_struts
 FROM (SELECT id ,drug_level_name FROM drug_level WHERE levels=2) a LEFT JOIN drug_details d  ON a.id=d.drug_level_id LEFT JOIN drug_type t
 ON d.drug_id=t.drug_details_id LEFT JOIN cy_reagent r ON t.id=r.cy_drug_type_id LEFT JOIN cy_compay c ON r.cy_company_id=c.compay_id
 WHERE  r.del_struts!='1' AND r.audit_struts='0'
</select>


	<!--后台药品百科审核(查询)-->
	<select id="byConditionDrug" resultMap="myDrugbackstage">
		SELECT a.id,a.drug_level_name,d.drug_id,d.drug_name,r.cy_reagent_id,r.cy_reagent_name,c.compay_id,c.compay_name,r.upload_admin,r.re_upload_time,r.audit_struts
		FROM (SELECT id ,drug_level_name FROM drug_level WHERE levels=2) a LEFT JOIN drug_details d  ON a.id=d.drug_level_id LEFT JOIN drug_type t
		ON d.drug_id=t.drug_details_id LEFT JOIN cy_reagent r ON t.id=r.cy_drug_type_id LEFT JOIN cy_compay c ON r.cy_company_id=c.compay_id
		<where>

			<if test="minTime !=null">
				<![CDATA[  r.re_upload_time >= #{minTime} ]]>
			</if>
			<if test="maxTime!=null">
				<![CDATA[ AND r.re_upload_time <= #{maxTime} ]]>
			</if>
			<if test="cyReagentName!=null and cyReagentName!=''">
				AND r.cy_reagent_name like concat('%',#{cyReagentName},'%')
			</if>
			<if test="uploadAdmin!=null and uploadAdmin!=''">
				AND r.upload_admin like concat('%',#{uploadAdmin},'%')
			</if>
		</where>
		and r.del_struts!='1' AND r.audit_struts='0' ORDER BY r.re_upload_time ASC
	</select>



	<!--后台查看公司药品信息-->
<select id="lookBackDrug" resultMap="myDrugbackstage">
SELECT
    a.drug_level_name,d.drug_name,r.cy_reagent_name,c.compay_name,r.audit_admin,
	rd.drug_alias,rd.cy_reagent_details_id,rd.Indications,rd.adverse_reactions,rd.contraindication,
	rd.drug_dose,rd.drug_interactions,rd.drug_unit,rd.medicine_hint,rd.take_method,rd.crowd_medication,rd.drug_other
    FROM (SELECT id ,drug_level_name FROM drug_level WHERE levels=2) a LEFT JOIN  drug_details d ON a.id=d.drug_level_id LEFT JOIN drug_type t
    ON d.drug_id=t.drug_details_id LEFT JOIN cy_reagent r ON t.id=r.cy_drug_type_id  LEFT JOIN cy_reagent_details rd ON r.cy_reagent_id=rd.cy_reagent_id LEFT JOIN
    cy_compay c ON r.cy_company_id=c.compay_id
WHERE r.cy_reagent_id=#{cyReagentId}
</select>



	<!--后台百科药品列表-->
<select id="selectCyBackDrugTable" resultMap="myDrugbackstage">
		 SELECT a.id,a.drug_level_name,d.drug_id,d.drug_name,r.cy_reagent_id,r.cy_reagent_name,c.compay_id,c.compay_name,r.create_time,r.exist_struts
 FROM (SELECT id ,drug_level_name FROM drug_level WHERE levels=2) a LEFT JOIN drug_details d  ON a.id=d.drug_level_id LEFT JOIN drug_type t
 ON d.drug_id=t.drug_details_id LEFT JOIN cy_reagent r ON t.id=r.cy_drug_type_id LEFT JOIN cy_compay c ON r.cy_company_id=c.compay_id WHERE r.del_struts!='1'AND r.audit_struts='1'

</select>
	<!--后台百科药品列表(查询)-->
	<select id="byConditionDrugTable" resultMap="myDrugbackstage">
		SELECT a.id,a.drug_level_name,d.drug_id,d.drug_name,r.cy_reagent_id,r.cy_reagent_name,c.compay_id,c.compay_name,r.audit_admin,r.re_check_pass_time,r.exist_struts
		FROM (SELECT id ,drug_level_name FROM drug_level WHERE levels=2) a LEFT JOIN drug_details d  ON a.id=d.drug_level_id LEFT JOIN drug_type t
		ON d.drug_id=t.drug_details_id LEFT JOIN cy_reagent r ON t.id=r.cy_drug_type_id LEFT JOIN cy_compay c ON r.cy_company_id=c.compay_id
		<where>

			<if test="minTime !=null">
				<![CDATA[  r.re_check_pass_time >= #{minTime} ]]>
			</if>
			<if test="maxTime!=null">
				<![CDATA[ AND r.re_check_pass_time <= #{maxTime} ]]>
			</if>
			<if test="cyReagentName!=null and cyReagentName!=''">
				AND r.cy_reagent_name like concat('%',#{cyReagentName},'%')
			</if>
			<if test="auditAdmin!=null and auditAdmin!=''">
				AND r.audit_admin like concat('%',#{auditAdmin},'%')
			</if>
		</where>
		and  r.del_struts!='1' AND r.audit_struts='1'  ORDER BY r.re_check_pass_time ASC
	</select>

	<!--药品百科审核列表-->
<select id="DrugEncyclopediaAuditList" resultMap="myDrugbackstage">
 SELECT a.id,a.drug_level_name,d.drug_id,d.drug_name,r.cy_reagent_id,r.cy_reagent_name,c.compay_id,c.compay_name,r.create_time,r.audit_admin,r.audit_struts,r.del_struts
 FROM (SELECT id ,drug_level_name FROM drug_level WHERE levels=2) a LEFT JOIN drug_details d  ON a.id=d.drug_level_id LEFT JOIN drug_type t
 ON d.drug_id=t.drug_details_id LEFT JOIN cy_reagent r ON t.id=r.cy_drug_type_id LEFT JOIN cy_compay c ON r.cy_company_id=c.compay_id
 WHERE r.audit_struts='2' AND r.del_struts !='1'
</select>


		<!--药品百科审核列表(查询)-->
<select id="drugEncycAuditTable" resultMap="myDrugbackstage">
	SELECT a.id,a.drug_level_name,d.drug_id,d.drug_name,r.cy_reagent_id,r.cy_reagent_name,c.compay_id,c.compay_name,r.re_audit_time,r.audit_admin,r.audit_struts,r.del_struts
	FROM (SELECT id ,drug_level_name FROM drug_level WHERE levels=2) a LEFT JOIN drug_details d  ON a.id=d.drug_level_id LEFT JOIN drug_type t
	ON d.drug_id=t.drug_details_id LEFT JOIN cy_reagent r ON t.id=r.cy_drug_type_id LEFT JOIN cy_compay c ON r.cy_company_id=c.compay_id
<where>

	<if test="minTime !=null">
		<![CDATA[  r.re_audit_time >= #{minTime} ]]>
	</if>
	<if test="maxTime!=null">
		<![CDATA[ AND r.re_audit_time <= #{maxTime} ]]>
	</if>
	<if test="cyReagentName!=null and cyReagentName!=''">
		AND r.cy_reagent_name like concat('%',#{cyReagentName},'%')
	</if>
	<if test="auditAdmin!=null and auditAdmin!=''">
		AND r.audit_admin like concat('%',#{auditAdmin},'%')
	</if>
</where>
 and r.audit_struts='2' AND r.del_struts !='1'  ORDER BY r.re_audit_time ASC
</select>

	<!--根据姓名查询(添加时是否数据重复)-->
	<select id="selectName" resultType="java.lang.String">
		select drug_level_name from drug_level where drug_level_name=#{drugLevelName}
	</select>

</mapper>
